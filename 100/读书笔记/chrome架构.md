# Cheome架构

## 1. 进程和线程

**四个特点**

1.  进程中的任意一线程执行出错，都会导致整个进程的崩溃。
2.  线程之间共享进程中的数据。
3.  当一个进程关闭之后，操作系统会回收进程所占用的内存。
4.  进程之间的内容相互隔离。

### 线程

**线程不能单独存在，由进程启动和管理**

**线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率**

### 进程

**一个进程就是一个程序的运行实例**：启动一个程序的时候，操作系统会为该 程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的 一个运行环境叫**进程**

## 2. 打开一个页面四个进程

### 07年以前单进程浏览器时代

**问题**

1. 不稳定
2. 不流畅
3. 不安全

### 多进程时代

#### 当前的四个进程

1. **浏览器进程（browser process）**：负责界面显示、用户交互、子进程管理，同时提供存储等功能。
2. **渲染进程（render process）：**将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页， 排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会 为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。
3. **gpu进程**：Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷 是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘 制，这使得 GPU 成为浏览器普遍的需求。
4. **网络进程**：主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面 的，直至最近才独立出来，成为一个单独的进程。
5. **插件进程**：主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保 证插件进程崩溃不会对浏览器和页面造成影响。

#### 问题

1. 更高的资源占用
2. 更复杂的体系架构

#### 未来

“面向服务的架构”（Services Oriented Architecture，简称SOA）的思想设计了新的 Chrome 架

Chrome 最终要把 UI、数据库、文件、设备、网络等模块重构为基础服务，类似操作系统 底层服务

### 3. 多个网页共用一个进程

1. Chrome的默认策略是，每个标签对应一个渲染进程。但是如果从一个页面打开了新页面，而新页 面和当前页面属于同一站点时，那么新页面会复用父页面的渲染进程。
2. 官方把这个默认策略叫**process-per-site-instance**。 直白的讲，就是如果几个页面符合同一站点，那么他们将被分配到一个渲染进程里面去。 所以，这种情况下，一个页面崩溃了，会导致同一站点的页面同时崩溃，因为他们使用了同一个 渲染进程。 
3. **为什么要让他们跑在一个进程里面呢？** 因为在一个渲染进程里面，他们就会共享JS的执行环境，也就是说A页面可以直接在B页面中执行 脚本。因为是同一家的站点，所以是有这个需求的。